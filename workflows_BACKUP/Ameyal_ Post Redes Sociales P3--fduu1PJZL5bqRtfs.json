{"updatedAt":"2026-01-06T00:16:32.000Z","createdAt":"2026-01-06T00:16:32.707Z","id":"fduu1PJZL5bqRtfs","name":"Ameyal: Post Redes Sociales P3","description":null,"active":false,"isArchived":false,"nodes":[{"parameters":{"rule":{"interval":[{"field":"weeks","triggerAtDay":[1,2,3,4,5],"triggerAtHour":9}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-1040,640],"id":"7b8f6459-1e82-46ec-bb12-47555de2015e","name":"Schedule Trigger1"},{"parameters":{"template_id":{"__rl":true,"value":"={{ $('varPostIMG').item.json.Plantilla}}","mode":"id"},"layers":{"layerItems":[{"layerId":"quote|text","property":"text","textValue":"={{ $('varPostIMG').item.json['Frase Clave'][0] }}"},{"layerId":"fondo|picture","property":"imageBinary","imageBinaryValue":"data"},{"layerId":"fondo-color|rectangle","property":"background_color","background_colorValue":"={{ $('varPostIMG').item.json.Color }}"},{"layerId":"decoracion-color|rectangle","property":"background_color","background_colorValue":"={{ $('varPostIMG').item.json.Color }}"},{"layerId":"quote-bg|rectangle","property":"background_color","background_colorValue":"={{ $('varPostIMG').item.json.Color }}"}]},"additionalFields":{}},"type":"n8n-nodes-placid.placid","typeVersion":1,"position":[1152,480],"id":"9ea7d74f-7623-4f1a-98dd-3b251cd7d4ac","name":"Create an image from a template","retryOnFail":true,"waitBetweenTries":5000,"onError":"continueErrorOutput"},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[2048,256],"id":"08b6ede4-40e8-4fb7-8431-36db98b2de98","name":"Wait11","webhookId":"e42f9b4f-719c-4dc8-acde-6c4309071b51"},{"parameters":{"chatId":"1019249029","text":"=⚠️​ {{ $(\"masterVar\").item.json.Cliente }} ⚠️​\nHubo un error al querer hacer la publicación de hoy publicar","additionalFields":{"appendAttribution":false,"parse_mode":"HTML"}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[2048,688],"id":"e2d5fa0d-3e61-4e22-97e4-1257d5ec2696","name":"⚠️​2","webhookId":"497ccf52-9a91-4025-adab-3d0773e84648","executeOnce":true},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[3008,352],"id":"a29022cb-c012-485f-8c34-44145ea5a09b","name":"No Operation, do nothing2"},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1360,464],"id":"49de1b29-c1ce-4f8d-aef2-4f77f14b9380","name":"Wait12","webhookId":"d498e686-4b7d-40d2-a8b2-545ae12270b4"},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[2048,416],"id":"f298d287-1b77-42c0-85ea-84b877dfdefd","name":"Wait13","webhookId":"f61a808b-0f3c-436c-9db2-f7162a1eeb52"},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1280,1088],"id":"6de9a3ed-06bf-4ef1-be5c-c030e3da668f","name":"Wait15","webhookId":"ae7e0d55-3f7a-45a5-b9b9-fcd4f2cac2e7"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[976,1392],"id":"9817bcd0-a775-4513-a623-0597f15ed2df","name":"Loop Over Items2"},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1472,1392],"id":"215a4e93-6cec-46dc-bc14-bed2d2070e3a","name":"Wait16","webhookId":"282b7557-6312-412b-9823-5d464b664841"},{"parameters":{"jsCode":"// 1) Normaliza campos y valida, pero solo conserva los que tienen image_url\nconst normalized = items\n  .map((it, pos) => {\n    const j = it.json || {};\n    const indice = Number(j.indice ?? j.index ?? pos + 1);\n    const url =\n      j.image_url ??\n      j.imageUrl ??\n      j.url ??\n      null;\n\n    if (!Number.isFinite(indice)) return null;\n    if (!url || typeof url !== 'string') return null;\n\n    return {\n      indice,\n      image_url: url.trim(),\n    };\n  })\n  .filter(x => x !== null); // elimina los que no tienen image_url\n\n// 2) Eliminar duplicados por indice (conserva el primero)\nconst seen = new Set();\nconst deduped = normalized.filter(({ indice }) => {\n  if (seen.has(indice)) return false;\n  seen.add(indice);\n  return true;\n});\n\n// 3) Ordena por indice ascendente\ndeduped.sort((a, b) => a.indice - b.indice);\n\n// 4) Agrega en estructuras útiles\nconst images = deduped.map(x => x.image_url);\nconst indices = deduped.map(x => x.indice);\nconst images_by_index = Object.fromEntries(\n  deduped.map(x => [String(x.indice), x.image_url])\n);\n\n// 5) Devuelve un único item agregado\nreturn [\n  {\n    json: {\n      count: images.length,\n      images,             // [\"url_slide1\", \"url_slide2\", ...] (ordenado)\n      indices,            // [1,2,3,...] (ordenado)\n      images_by_index     // {\"1\": \"url...\", \"2\": \"url...\", ...}\n    }\n  }\n];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1280,1264],"id":"ebc73d33-4a7f-40d8-970d-ac04451eeeb9","name":"Code"},{"parameters":{"assignments":{"assignments":[{"id":"c7738286-9bb2-4b6a-b9d6-ecec57d193e7","name":"indice","value":"={{ $('Loop Over Items2').item.json.indice }}","type":"number"},{"id":"3c59ef3e-a3d8-43d4-848c-f6b90625217e","name":"image_url","value":"={{ $json.image_url }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1696,1392],"id":"92541301-c814-41e7-9398-bceff55ab565","name":"varSlides1"},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[1488,1200],"id":"d7a79470-1bd4-4adf-8ddd-e029742d2bcc","name":"Merge4"},{"parameters":{"jsCode":"// Entrada esperada (items del Merge):\n// items[0].json -> portada con image_url\n// items[1].json -> slides con images[], indices[] y/o images_by_index{}\n\nconst inItems = items.map(i => i.json ?? {});\n\n// --- Detectar portada y slides ---\nlet coverUrl = null;\nlet slidePairs = []; // { indice:number, img:string }\n\nfor (const j of inItems) {\n  // Portada\n  if (typeof j.image_url === 'string' && j.image_url.trim()) {\n    coverUrl = j.image_url.trim();\n  } else if (typeof j.portada_url === 'string' && j.portada_url.trim()) {\n    coverUrl = j.portada_url.trim();\n  } else if (typeof j.cover_url === 'string' && j.cover_url.trim()) {\n    coverUrl = j.cover_url.trim();\n  }\n\n  // Slides (varias formas)\n  if (j && typeof j === 'object') {\n    if (j.images_by_index && typeof j.images_by_index === 'object') {\n      for (const [k, v] of Object.entries(j.images_by_index)) {\n        const idx = Number(k);\n        if (Number.isFinite(idx) && typeof v === 'string' && v.trim()) {\n          slidePairs.push({ indice: idx, img: v.trim() });\n        }\n      }\n    } else if (Array.isArray(j.images)) {\n      const imgs = j.images.filter(u => typeof u === 'string' && u.trim());\n      if (Array.isArray(j.indices) && j.indices.length === imgs.length) {\n        for (let i = 0; i < imgs.length; i++) {\n          const idx = Number(j.indices[i]);\n          if (Number.isFinite(idx)) slidePairs.push({ indice: idx, img: imgs[i].trim() });\n        }\n      } else {\n        // sin indices: asumimos orden natural 1..N\n        for (let i = 0; i < imgs.length; i++) {\n          slidePairs.push({ indice: i + 1, img: imgs[i].trim() });\n        }\n      }\n    }\n  }\n}\n\n// --- Deduplicar por indice y ordenar ---\nconst seen = new Set();\nslidePairs = slidePairs.filter(p => {\n  const k = String(p.indice);\n  if (seen.has(k)) return false;\n  seen.add(k);\n  return true;\n}).sort((a, b) => a.indice - b.indice);\n\n// --- Construir salida (un item por imagen) ---\nconst out = [];\n\n// Portada (indice 0) primero, si existe\nif (coverUrl) out.push({ indice: 0, img: coverUrl });\n\n// Luego slides 1..N\nfor (const p of slidePairs) {\n  out.push({ indice: Number(p.indice), img: p.img });\n}\n\n// Validaciones mínimas\nif (out.length === 0) {\n  throw new Error('No se encontraron imágenes de portada ni slides.');\n}\n\n// Devolver un item por imagen (ideal para “cargar el slide” en Blotato)\nreturn out.map(o => ({ json: o }));"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1696,1200],"id":"cc9bd8fe-6a5f-4324-be51-bf3bf8d4003b","name":"imgSlide1"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[1904,1200],"id":"17f6026b-ce6b-4c71-aff6-22706beea3a2","name":"Loop Over Items3"},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[2304,1264],"id":"621f1931-aaba-4a1d-899c-51babe7e73b4","name":"Wait17","webhookId":"a249c88a-4385-40ca-aa6e-0e3ccfc0cff2"},{"parameters":{"mode":"chooseBranch"},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[2288,944],"id":"6e43bf4f-6a40-4ac5-9258-63c370ee6403","name":"Merge5"},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[3024,928],"id":"1128f437-5661-414f-8cc3-6fc2ee8707e8","name":"Wait18","webhookId":"6739828f-feba-4237-8a85-2d6b9d853507"},{"parameters":{"chatId":"1019249029","text":"=⚠️​ {{ $(\"masterVar\").item.json.Cliente }} ⚠️​\nHubo un error al querer hacer la publicación de hoy publicar","additionalFields":{"appendAttribution":false,"parse_mode":"HTML"}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[3040,1440],"id":"b819e101-3da9-401e-95f8-d3d5721a8218","name":"⚠️​3","webhookId":"6f0ab2ae-79e5-46ec-ab56-a23160a9527a","executeOnce":true},{"parameters":{"chatId":"1019249029","text":"=✅​ {{ $node[\"masterVar\"].json['Cliente'] }} ✅​​\nSe realizó el posteo correctamente","additionalFields":{"appendAttribution":false,"parse_mode":"HTML"}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[3664,1056],"id":"16cad485-60ca-4253-96a7-72ef8900688d","name":"✅​3","webhookId":"ef8d65ff-84eb-488f-a88a-83cb4274fc9a","executeOnce":true},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[3872,1344],"id":"70af5e4b-47de-4a60-9bb4-6e5008026765","name":"No Operation, do nothing3"},{"parameters":{"operation":"create","base":{"__rl":true,"value":"={{ $node[\"masterVar\"].json['airtableBase'] }}","mode":"id"},"table":{"__rl":true,"value":"={{ $node[\"masterVar\"].json['Redes Sociales'] }}","mode":"id"},"columns":{"mappingMode":"defineBelow","value":{"Caption":"={{ $('varPostCarrusel0').item.json['Caption de Facebook'] }}","Frase Clave":"={{ $('varPostCarrusel0').item.json['Frase Clave'].join(\", \").replace(/\\n/g, \" \")  }}","Tipo":"Carrusel","Red Social":"Facebook","Fecha publicación":"={{ $now.toISO() }}","Color":"={{ $('varPostCarrusel0').item.json['Color'] }}"},"matchingColumns":[],"schema":[{"id":"Caption","displayName":"Caption","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Frase Clave","displayName":"Frase Clave","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Tipo","displayName":"Tipo","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"options","options":[{"name":"Imagen","value":"Imagen"},{"name":"Carrusel","value":"Carrusel"},{"name":"Video","value":"Video"}],"readOnly":false,"removed":false},{"id":"Red Social","displayName":"Red Social","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"options","options":[{"name":"Facebook","value":"Facebook"},{"name":"Instagram","value":"Instagram"}],"readOnly":false,"removed":false},{"id":"Color","displayName":"Color","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Fecha publicación","displayName":"Fecha publicación","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"dateTime","readOnly":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[3248,928],"id":"0d5b83c9-1f7c-4071-ba1d-d2a9a2267da3","name":"Create a record6"},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[3024,1104],"id":"514752ee-f40e-498f-bccd-5f5077a89837","name":"Wait19","webhookId":"f990a07b-7c43-4354-82a1-79d902683ec1"},{"parameters":{"operation":"create","base":{"__rl":true,"value":"={{ $node[\"masterVar\"].json['airtableBase'] }}","mode":"id"},"table":{"__rl":true,"value":"={{ $node[\"masterVar\"].json['Redes Sociales'] }}","mode":"id"},"columns":{"mappingMode":"defineBelow","value":{"Caption":"={{ $('varPostCarrusel0').item.json['Caption de Instagram'] }}","Frase Clave":"={{ $('varPostCarrusel0').item.json['Frase Clave'].join(\", \").replace(/\\n/g, \" \")  }}","Tipo":"Carrusel","Red Social":"Instagram","Color":"={{ $('varPostCarrusel0').item.json.Color }}","Fecha publicación":"={{ $now.toISO() }}"},"matchingColumns":[],"schema":[{"id":"Caption","displayName":"Caption","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Frase Clave","displayName":"Frase Clave","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Tipo","displayName":"Tipo","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"options","options":[{"name":"Imagen","value":"Imagen"},{"name":"Carrusel","value":"Carrusel"},{"name":"Video","value":"Video"}],"readOnly":false,"removed":false},{"id":"Red Social","displayName":"Red Social","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"options","options":[{"name":"Facebook","value":"Facebook"},{"name":"Instagram","value":"Instagram"}],"readOnly":false,"removed":false},{"id":"Color","displayName":"Color","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Fecha publicación","displayName":"Fecha publicación","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"dateTime","readOnly":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[3248,1104],"id":"9d69a87d-0cb3-40a9-8bcb-cc86d2a26abe","name":"Create a record7"},{"parameters":{"jsCode":"// Objetivo: devolver { mediaUrls: \"U1, U2, U3\" } sin repetir y en orden correcto.\n\n// 1) Extrae URL y posible índice\nconst pairs = items\n  .map((it, i) => {\n    const j = it.json ?? {};\n    const url =\n      (typeof j.url === 'string' && j.url.trim())\n        ? j.url.trim()\n        : (typeof j?.mediaUploadResponse?.url === 'string'\n            ? j.mediaUploadResponse.url.trim()\n            : null);\n\n    if (!url) return null;\n\n    const idx = Number.isFinite(Number(j.indice)) ? Number(j.indice) : i;\n    return { idx, url };\n  })\n  .filter(Boolean);\n\n// 2) Ordena por indice si hay índices personalizados\nconst hasCustomIndex = pairs.some((p, i) => p.idx !== i);\nif (hasCustomIndex) {\n  pairs.sort((a, b) => a.idx - b.idx);\n}\n\n// 3) Dedup: elimina repetidos preservando la primera aparición\nconst seen = new Set();\nconst orderedUnique = [];\nfor (const { url } of pairs) {\n  if (!seen.has(url)) {\n    seen.add(url);\n    orderedUnique.push(url);\n  }\n}\n\n// 4) Une con coma + espacio (formato solicitado)\nconst csv = orderedUnique.join(', ');\n\n// 5) Valida y retorna siempre un objeto\nif (!csv) {\n  throw new Error('No se encontraron mediaUrls válidas en la entrada.');\n}\n\nreturn [{ json: { mediaUrlsCarrusel: csv } }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2128,1104],"id":"d44ceff7-51f2-44db-9d16-03ac631241f0","name":"mediaUrlsCarrusel1"},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[3472,1056],"id":"cf152d59-fcbd-4e2c-8012-1a7033b34a47","name":"Merge6"},{"parameters":{"chatId":"1019249029","text":"=✅​  {{ $node[\"masterVar\"].json['Cliente'] }} ✅\nSe realizó el posteo correctamente","additionalFields":{"appendAttribution":false,"parse_mode":"HTML"}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[2624,352],"id":"9232ee83-8ac2-40ea-b995-bf2c9537a8e2","name":"✅​1","webhookId":"f75c0a97-793e-4458-9471-4c885c7b5e14","executeOnce":true},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[2448,352],"id":"85ac8b69-35b1-41f9-a874-37d08b805d0b","name":"Merge7"},{"parameters":{"amount":"={{ $json.numero }}","unit":"minutes"},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-624,640],"id":"2bb391db-d2f2-4c68-b0a5-545225b379e3","name":"Wait","webhookId":"d19fa250-4fc9-4b84-b51a-3a3e0ea0cf62"},{"parameters":{"jsCode":"const numero = Math.floor(Math.random() * 45) + 1;\n\nreturn [\n  {\n    json: {\n      numero\n    }\n  }\n];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-832,640],"id":"a5c8153f-753d-4f4a-9f84-916f7e7dec39","name":"Code1"},{"parameters":{"assignments":{"assignments":[{"id":"65e4fb7b-f885-41b8-9232-8435caa54ea9","name":"Cliente","value":"Ameyal Inmobiliaria","type":"string"},{"id":"0bcc34a6-73fa-4691-bd4e-0a1f8fc4a02a","name":"airtableBase","value":"appb83b3VCKAonLjs","type":"string"},{"id":"68457664-8845-487a-8c77-ac212972b1a6","name":"Redes Sociales","value":"tblSHOlC917rApYNT","type":"string"},{"id":"d57d84c8-d526-45fe-8a92-d74598655559","name":"plantillaIMG","value":"qpm2c3pvtkrjz","type":"string"},{"id":"bc5799d2-dd3f-4caf-b76f-8b5b2ebdb1d7","name":"plantillaCarrucelTitulo","value":"xvjhrg4x4fihy","type":"string"},{"id":"384ae256-b521-4aac-addb-8ce4995bc95b","name":"plantillaCarruselCuerpo","value":"fz0iidmaxyycr","type":"string"},{"id":"dfa0db3b-54c4-4d64-9674-fb3064cd336a","name":"plantillaCarruselVideo","value":"ignas3vh5cxnp","type":"string"},{"id":"e3e9f354-3f3c-4cdb-8dde-1437dccae795","name":"Color1","value":"#512E88","type":"string"},{"id":"84d996d2-f399-4e98-8f66-747b00062691","name":"Color2","value":"#1391C2","type":"string"},{"id":"7af64247-e024-4de9-9194-3fddf96b6ed2","name":"Color3","value":"#A72B69","type":"string"},{"id":"08bfdf7c-3ffd-451c-82ab-411dd8f9b303","name":"instagram","value":"15136","type":"string"},{"id":"aee51936-f5d7-4482-b16f-a2b6ee853b10","name":"facebook","value":"8833","type":"string"},{"id":"41274361-90f6-4b99-8552-492aee207794","name":"facebook_page","value":"727025147168558","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1056,928],"id":"89336240-03ec-46ca-a458-afbfd808131b","name":"masterVar"},{"parameters":{"promptType":"define","text":"=Genera una publicación educativa o de confianza para {{$node[\"masterVar\"].json['Cliente']}}, enfocada en atraer dueños de propiedades que desean vender o rentar.  \n\nEl contenido debe ser **claro, cercano y profesional**, transmitiendo **confianza y autoridad en el sector inmobiliario**.  \n\n➡️ Requisitos:  \n- Explica siempre un **beneficio práctico** para el propietario (ejemplo: cómo valorar su propiedad, cómo evitar riesgos, cómo acelerar la renta).  \n- Adopta un **tono consultivo y humano**, no de venta agresiva.  \n- Varía los ángulos en cada publicación (tips, errores comunes, pasos, beneficios).  \n- Siempre incluye un **CTA concreto** (ejemplo: agenda tu asesoría gratuita, solicita tu valuación, envía un mensaje).  ","options":{"systemMessage":"=Eres un Community Manager experto en marketing inmobiliario, especializado en atraer propietarios de inmuebles que desean vender o rentar.\n\n🎯 Objetivo  \nGenerar publicaciones educativas y de confianza que posicionen a la inmobiliaria como profesional, transparente y confiable.  \nEl contenido debe estar optimizado para **Instagram y Facebook**.\n\n📌 Formato de respuesta obligatorio (únicamente JSON válido, sin texto adicional):  \n{\n  \"Tipo\": \"Carrusel | Imagen | Video\",\n  \"Caption_Instagram\": \"Texto breve y dinámico con emojis, máximo 2 párrafos de hasta 220 caracteres cada uno, tono cercano y amigable, con CTA claro.\",\n  \"Caption_Facebook\": \"Texto más completo (3 a 5 párrafos), tono profesional e informativo, puede usar emojis con moderación, siempre con CTA claro al final.\",\n  \"Frase Clave\": [\n    \"Título principal\",\n    \"Frase subsecuente 1\",\n    \"Frase subsecuente 2\"\n  ],\n  \"Color\": \"#HEXCOLOR\",\n  \"Slides\": 5\n}\n\n🔧 Fuente de contexto:  \nPost Históricos → contiene los últimos 30 posts (ordenados del más reciente al más antiguo).  \nUsa esta información para:  \n- Evitar duplicar contenido: tanto Caption como Frase Clave deben diferir de los últimos posts.  \n\n⚙️ Reglas de generación:  \n1. **Color y Tipo**  \n   - Usa estrictamente los valores recibidos: `\"Tipo\": \"{{ $json.Tipo }}\"` y `\"Color\": \"{{ $json.Color }}\"`.  \n   - Nunca inventes nuevos valores.  \n\n2. **Imagen o Video**  \n   - `\"Frase Clave\"` debe contener solo **1 frase poderosa, breve e impactante** (como un slogan).  \n   - No incluyas la clave `\"Slides\"`.  \n\n3. **Carrusel**  \n   - `\"Frase Clave\"` debe contener entre 4 y 6 frases (la primera es el título principal).  \n   - Incluye siempre `\"Slides\"` con el número total de frases.  \n\n🔒 Nota: Responde únicamente en **JSON válido**. No devuelvas explicaciones, comentarios ni texto fuera de la estructura."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[-384,928],"id":"47125551-4e9c-40b7-8cac-024d0d03a3ce","name":"AI Agent"},{"parameters":{"model":{"__rl":true,"value":"gpt-4","mode":"list","cachedResultName":"gpt-4"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-384,1136],"id":"d2b78971-0c6f-4b98-82c2-6858e5f17d6e","name":"OpenAI Chat Model"},{"parameters":{"jsCode":"return items.map(item => {\n  let raw = item.json.output;\n  if (typeof raw !== \"string\") {\n    return [{\n      json: {\n        error: true,\n        rawOutput: raw,\n        message: \"El campo 'output' no es un string válido.\"\n      }\n    }];\n  }\n\n  let parsed;\n\n  try {\n    // 1) Extraer bloque JSON más probable si hay texto adicional\n    const match = raw.match(/\\{[\\s\\S]*\\}/);\n    if (!match) {\n      return [{\n        json: {\n          error: true,\n          rawOutput: raw,\n          message: \"No se encontró un bloque JSON en la respuesta.\"\n        }\n      }];\n    }\n    let cleaned = match[0];\n\n    // 2) Eliminar caracteres de control invisibles\n    cleaned = cleaned.replace(/[\\u0000-\\u001F\\u007F]/g, \" \").trim();\n\n    // 3) Intentar parsear\n    parsed = JSON.parse(cleaned);\n\n  } catch (e) {\n    return [{\n      json: {\n        error: true,\n        rawOutput: raw,\n        message: \"No se pudo parsear el JSON: \" + e.message\n      }\n    }];\n  }\n\n  // 4) Normalizar claves\n  const norm = {};\n  for (const [k, v] of Object.entries(parsed)) {\n    const key = k.toLowerCase().replace(/\\s+/g, \"_\");\n    norm[key] = v;\n  }\n\n  // 5) Construir el objeto base\n  const result = {\n    Tipo: norm.tipo || \"\",\n    Caption_Instagram: norm.caption_instagram || \"\",\n    Caption_Facebook: norm.caption_facebook || \"\",\n    \"Frase Clave\": Array.isArray(norm.frase_clave)\n      ? norm.frase_clave\n      : norm.frase_clave\n      ? [String(norm.frase_clave)]\n      : [],\n    Color: norm.color || \"\" // no lo alteramos, se toma directo de masterVar\n  };\n\n  // 6) Slides para Carrusel\n  if (String(result.Tipo).toLowerCase() === \"carrusel\") {\n    let slidesCount = norm.slides || result[\"Frase Clave\"].length;\n    result.Slides = Math.max(2, Math.min(6, slidesCount));\n  }\n\n  return { json: result };\n});"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-32,928],"id":"60b338a0-f377-460c-84bc-db5ad923ea2d","name":"Code in JavaScript"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.Tipo }}","rightValue":"Imagen","operator":{"type":"string","operation":"equals"},"id":"36aaf760-101c-4377-8a51-a6e49c314025"}],"combinator":"and"},"renameOutput":true,"outputKey":"Imagen"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"f9840fe7-de36-421e-95d7-016ccd082b80","leftValue":"={{ $json.Tipo }}","rightValue":"Carrusel","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Carrusel"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"0b618f49-015d-40e5-ad43-f8c138483757","leftValue":"={{ $json.Tipo }}","rightValue":"Video","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Video"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[192,912],"id":"a4116fa5-466b-437f-8c5f-e704e9c58167","name":"Switch"},{"parameters":{"assignments":{"assignments":[{"id":"5c3d170c-badd-4a4d-ac00-a569d416fbe1","name":"Tipo","value":"={{ $json.Tipo }}","type":"string"},{"id":"8426ab61-e126-49c1-9e5f-b3809e707cf5","name":"CaptionIN","value":"={{ $json.Caption_Instagram }}","type":"string"},{"id":"d6e7198a-6f4a-46a4-8511-1b359672c0ab","name":"CaptionFB","value":"={{ $json.Caption_Facebook }}","type":"string"},{"id":"b950c017-40ac-430d-bf11-1480faeda43d","name":"Frase Clave","value":"={{ $json['Frase Clave'] }}","type":"array"},{"id":"cb8113ab-a67e-4060-adf3-13329b1d0b1f","name":"Color","value":"={{ $json.Color }}","type":"string"},{"id":"7f0b0a4b-479a-4408-83c9-75f52b6397af","name":"Plantilla","value":"={{ $node[\"masterVar\"].json['plantillaIMG'] }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[512,480],"id":"e270433d-e857-4073-a23a-de64684d9811","name":"varPostIMG"},{"parameters":{"resource":"image","prompt":"=Crea una imagen hiperrealista que sirva como fondo atractivo para un post de redes sociales del sector inmobiliario. \n\nDebe transmitir profesionalismo, confianza y aspiración (hogares modernos, arquitectura elegante, estilo limpio). \nNo incluyas texto ni logotipos en la imagen. \nEl diseño debe ser minimalista, con iluminación natural y espacio visual suficiente para superponer tipografías o elementos gráficos. \n\nLos captions a acompañar en redes sociales son:\n- Facebook: {{ $json.CaptionFB }}\n- Instagram: {{ $json.CaptionIN }}","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[704,480],"id":"0f8d61ac-7c6b-4279-a369-450ecf1b0e86","name":"fondoIMG"},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[928,480],"id":"d39ed69f-eb7c-4e8d-b4b1-33e67f00d93d","name":"Wait1","webhookId":"215cadd5-986a-4d31-8dfe-ada48fb669da"},{"parameters":{"operation":"create","base":{"__rl":true,"value":"={{ $node[\"masterVar\"].json['airtableBase'] }}","mode":"id"},"table":{"__rl":true,"value":"={{ $node[\"masterVar\"].json['Redes Sociales'] }}","mode":"id"},"columns":{"mappingMode":"defineBelow","value":{"Caption":"={{ $('varPostIMG').item.json.CaptionIN }}","Frase Clave":"={{ $('varPostIMG').item.json['Frase Clave'][0] }}","Tipo":"={{ $('varPostIMG').item.json.Tipo }}","Red Social":"Instagram","Color":"={{ $('varPostIMG').item.json.Color }}","Fecha publicación":"={{ $now.toISO() }}"},"matchingColumns":[],"schema":[{"id":"Caption","displayName":"Caption","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Frase Clave","displayName":"Frase Clave","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Tipo","displayName":"Tipo","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"options","options":[{"name":"Imagen","value":"Imagen"},{"name":"Carrusel","value":"Carrusel"},{"name":"Video","value":"Video"}],"readOnly":false,"removed":false},{"id":"Red Social","displayName":"Red Social","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"options","options":[{"name":"Facebook","value":"Facebook"},{"name":"Instagram","value":"Instagram"}],"readOnly":false,"removed":false},{"id":"Color","displayName":"Color","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Fecha publicación","displayName":"Fecha publicación","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"dateTime","readOnly":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[2272,256],"id":"6b55af92-e0a9-4d66-827b-95157c710f9a","name":"CreateINPost"},{"parameters":{"operation":"create","base":{"__rl":true,"value":"={{ $node[\"masterVar\"].json['airtableBase'] }}","mode":"id"},"table":{"__rl":true,"value":"={{ $node[\"masterVar\"].json['Redes Sociales'] }}","mode":"id"},"columns":{"mappingMode":"defineBelow","value":{"Tipo":"={{ $('varPostIMG').item.json.Tipo }}","Caption":"={{ $('varPostIMG').item.json.CaptionFB }}","Frase Clave":"={{ $('varPostIMG').item.json['Frase Clave'].join(', ') }}","Red Social":"Facebook","Fecha publicación":"={{ $now.toISO() }}","Color":"={{ $('varPostIMG').item.json.Color }}"},"matchingColumns":[],"schema":[{"id":"Caption","displayName":"Caption","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Frase Clave","displayName":"Frase Clave","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Tipo","displayName":"Tipo","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"options","options":[{"name":"Imagen","value":"Imagen"},{"name":"Carrusel","value":"Carrusel"},{"name":"Video","value":"Video"}],"readOnly":false,"removed":false},{"id":"Red Social","displayName":"Red Social","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"options","options":[{"name":"Facebook","value":"Facebook"},{"name":"Instagram","value":"Instagram"}],"readOnly":false,"removed":false},{"id":"Color","displayName":"Color","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Fecha publicación","displayName":"Fecha publicación","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"dateTime","readOnly":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[2272,416],"id":"4f72ecd4-4a8b-42a1-8d33-37978a20f820","name":"CreateFBPost"},{"parameters":{"resource":"image","prompt":"=Crea una imagen hiperrealista que sirva como fondo atractivo para un post de redes sociales del sector inmobiliario. \n\nDebe transmitir profesionalismo, confianza y aspiración (hogares modernos, arquitectura elegante, estilo limpio). \nNo incluyas texto ni logotipos en la imagen. \nEl diseño debe ser minimalista, con iluminación natural y espacio visual suficiente para superponer tipografías o elementos gráficos. \n\nLos captions a acompañar en redes sociales son:\n- Facebook: {{ $json.CaptionFB }}\n- Instagram: {{ $json.CaptionIN }}","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[688,1104],"id":"b52eeba9-985d-449c-8d70-75e1a463cea1","name":"fondoIMG1"},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[880,1104],"id":"8a0f5d4a-1c20-46e4-a200-53349c75bfbd","name":"Wait2","webhookId":"2c29d832-ceec-4d7d-925e-d9717dd51a43"},{"parameters":{"template_id":{"__rl":true,"value":"={{ $node[\"varPostCarrusel3\"].json['PlantillaTitulo'] }}","mode":"id"},"layers":{"layerItems":[{"layerId":"img|picture","property":"imageBinary","imageBinaryValue":"data"},{"layerId":"title|text","property":"text","textValue":"={{ $node[\"varPostCarrusel3\"].json['carruselTitulo'] }}"},{"layerId":"Marco|rectangle","property":"background_color","background_colorValue":"={{ $node[\"varPostCarrusel3\"].json['Color'] }}"},{"layerId":"bg|rectangle","property":"background_color","background_colorValue":"={{ $node[\"varPostCarrusel3\"].json['Color'] }}"}]},"additionalFields":{}},"type":"n8n-nodes-placid.placid","typeVersion":1,"position":[1072,1104],"id":"d3711392-ddb6-4c09-a241-c06abf027153","name":"PortadaCarrusel","retryOnFail":true,"waitBetweenTries":5000,"onError":"continueErrorOutput"},{"parameters":{"jsCode":"const data = items[0]?.json ?? {};\n\n// Validamos que existan FraseClave y al menos un elemento más allá del primero\nconst frases = Array.isArray(data.FraseClave) ? data.FraseClave.slice(1) : [];\n\nif (!frases.length) {\n  throw new Error('No hay frases clave suficientes después de eliminar la primera.');\n}\n\nconst color = data.Color ?? '#000000';\nconst plantilla = data.PlantillaCuerpo ?? '';\n\nreturn frases.map((texto, i) => {\n  return {\n    json: {\n      indice: i + 1,\n      texto: texto.trim(),\n      color,\n      plantilla\n    }\n  };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[736,1392],"id":"8c97a7d6-a19d-421a-9c78-112ff0362694","name":"Code in JavaScript1"},{"parameters":{"assignments":{"assignments":[{"id":"b950c017-40ac-430d-bf11-1480faeda43d","name":"FraseClave","value":"={{ $json['Frase Clave'] }}","type":"array"},{"id":"cb8113ab-a67e-4060-adf3-13329b1d0b1f","name":"Color","value":"={{ $json.Color }}","type":"string"},{"id":"07790429-9b37-4ec8-9853-22e8db58bfac","name":"PlantillaCuerpo","value":"={{ $node[\"masterVar\"].json['plantillaCarruselCuerpo'] }}","type":"string"},{"id":"e64d066f-2a03-47ca-a30c-6e89d812f3c8","name":"Slides","value":"={{ $json.Slides }}","type":"number"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[528,1392],"id":"f568818a-1c03-4260-9d61-4c2e4f6e2d8b","name":"varPostCarruselCuerpo"},{"parameters":{"template_id":{"__rl":true,"value":"={{ $json.plantilla }}","mode":"id"},"layers":{"layerItems":[{"layerId":"title|text","property":"text","textValue":"={{ $json.texto }}"},{"layerId":"Marco|rectangle","property":"background_color","background_colorValue":"={{ $json.color }}"}]},"additionalFields":{}},"type":"n8n-nodes-placid.placid","typeVersion":1,"position":[1280,1408],"id":"4d5b192e-959a-4f44-ac87-511606a30541","name":"slides","retryOnFail":true,"waitBetweenTries":5000,"onError":"continueErrorOutput"},{"parameters":{"assignments":{"assignments":[{"id":"8426ab61-e126-49c1-9e5f-b3809e707cf5","name":"CaptionIN","value":"={{ $json.Caption_Instagram }}","type":"string"},{"id":"d6e7198a-6f4a-46a4-8511-1b359672c0ab","name":"CaptionFB","value":"={{ $json.Caption_Facebook }}","type":"string"},{"id":"210672f3-b1c1-4804-bb6c-ac2a122ca272","name":"Color","value":"={{ $json.Color }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[512,928],"id":"111e84ad-e581-42eb-aee4-bb79567cbc89","name":"varPostCarrusel2"},{"parameters":{"assignments":{"assignments":[{"id":"0ac59ead-fc8d-4070-b52b-8759a768025b","name":"carruselTitulo","value":"={{ $json['Frase Clave'][0] }}","type":"string"},{"id":"cb8113ab-a67e-4060-adf3-13329b1d0b1f","name":"Color","value":"={{ $json.Color }}","type":"string"},{"id":"7f0b0a4b-479a-4408-83c9-75f52b6397af","name":"PlantillaTitulo","value":"={{ $node[\"masterVar\"].json['plantillaCarrucelTitulo'] }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[512,1104],"id":"d81903ae-6818-42da-8172-8ebfc4f5868c","name":"varPostCarrusel3"},{"parameters":{"assignments":{"assignments":[{"id":"88ab81c9-4cbf-4e4c-9563-f5ec4f58ea0e","name":"Caption de Facebook","value":"={{ $json.CaptionFB }}","type":"string"},{"id":"5107acff-164b-4417-99cc-407faae0a4a9","name":"Caption de Instagram","value":"={{ $json.CaptionIN }}","type":"string"},{"id":"bfc1c005-76b5-4fa5-82e6-0d0012ec0201","name":"mediaUrlsCarrusel","value":"={{ $items(\"mediaUrlsCarrusel1\", 0)[0].json.mediaUrlsCarrusel }}","type":"string"},{"id":"f178791f-9d08-4867-b816-73d5341c3900","name":"Frase Clave","value":"={{ $('Switch').item.json['Frase Clave'] }}","type":"array"},{"id":"9b34919c-5c19-44b1-962e-77f212d7dea9","name":"Color","value":"={{ $('varPostCarrusel2').item.json.Color }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2528,944],"id":"87f475ea-c752-4751-87e4-4a5dbbff33c0","name":"varPostCarrusel0"},{"parameters":{"content":"## ACTUALIZAR\nPROMPT","height":272,"width":224},"type":"n8n-nodes-base.stickyNote","position":[656,384],"typeVersion":1,"id":"d9a4d6e4-77e9-4f20-bbaa-f1f542a7e95d","name":"Sticky Note"},{"parameters":{"content":"## ACTUALIZAR\nPROMPT","height":272,"width":224},"type":"n8n-nodes-base.stickyNote","position":[640,1008],"typeVersion":1,"id":"392135f2-fa7b-4248-92e6-1dce45f649dc","name":"Sticky Note2"},{"parameters":{"content":"## ACTUALIZAR\nPROMPT","height":432,"width":352},"type":"n8n-nodes-base.stickyNote","position":[-432,848],"typeVersion":1,"id":"bfc54c13-9d71-4a86-960c-229c8c915c08","name":"Sticky Note6"},{"parameters":{"descriptionType":"manual","toolDescription":"Utiliza esta base como memoria, para que los post no lleguen a ser repetitivos en cuanto al contenido del Caption y Frase Clave, y rotes elementos clave como\n- Tipo\n- Color","resource":"base","operation":"getSchema","base":{"__rl":true,"value":"appb83b3VCKAonLjs","mode":"list","cachedResultName":"Ameyal","cachedResultUrl":"https://airtable.com/appb83b3VCKAonLjs"}},"type":"n8n-nodes-base.airtableTool","typeVersion":2.1,"position":[-224,1136],"id":"6b474a09-15b4-42d0-bf2e-1da8bd151186","name":"Post Historicos"},{"parameters":{"assignments":{"assignments":[{"id":"5c3d170c-badd-4a4d-ac00-a569d416fbe1","name":"Tipo","value":"={{ $json.Tipo }}","type":"string"},{"id":"8426ab61-e126-49c1-9e5f-b3809e707cf5","name":"CaptionIN","value":"={{ $json.Caption_Instagram }}","type":"string"},{"id":"d6e7198a-6f4a-46a4-8511-1b359672c0ab","name":"CaptionFB","value":"={{ $json.Caption_Facebook }}","type":"string"},{"id":"b950c017-40ac-430d-bf11-1480faeda43d","name":"Frase Clave","value":"={{ $json['Frase Clave'] }}","type":"array"},{"id":"cb8113ab-a67e-4060-adf3-13329b1d0b1f","name":"Color","value":"={{ $json.Color }}","type":"string"},{"id":"7f0b0a4b-479a-4408-83c9-75f52b6397af","name":"Plantilla","value":"={{ $node[\"masterVar\"].json['plantillaCarruselVideo'] }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[528,2048],"id":"0454e24f-e46b-4216-b9f9-cb22f9be5959","name":"varPostVideo"},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1632,1840],"id":"720d3f79-f696-440a-8051-9b76d46b3113","name":"Wait14","webhookId":"e50c4d84-57c0-4872-82e0-83f230057afb"},{"parameters":{"chatId":"1019249029","text":"=⚠️​ {{ $(\"masterVar\").item.json.Cliente }} ⚠️​\nHubo un error al querer hacer la publicación de hoy publicar","additionalFields":{"appendAttribution":false,"parse_mode":"HTML"}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[1840,2400],"id":"ee6489a1-ba40-4796-9756-e6dcb803b3b3","name":"⚠️​","webhookId":"cc02dfc3-0b83-4125-898a-008e3f2ac7cf","executeOnce":true},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[2512,1920],"id":"919b25bd-3b59-4161-a623-60eaf509f8a9","name":"No Operation, do nothing"},{"parameters":{"content":"## ACTUALIZAR\nID de Red Social","height":592,"width":224},"type":"n8n-nodes-base.stickyNote","position":[1360,1728],"typeVersion":1,"id":"85398fdb-b3ab-4d00-91f8-0684ff034e2f","name":"Sticky Note5"},{"parameters":{"amount":10},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[960,2032],"id":"6da02ded-a379-432c-8dd1-6d2aeda0c247","name":"Wait20","webhookId":"28fa0a1b-ae64-4aca-b2fa-4fd45a62e686"},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1632,1984],"id":"94d703bc-a3bb-49d6-bf47-377e5acc9096","name":"Wait21","webhookId":"6d361bf5-0dd4-48cc-b389-f356cea68811"},{"parameters":{"chatId":"1019249029","text":"=✅​ {{ $node[\"masterVar\"].json['Cliente'] }} ✅​\nSe realizó el posteo correctamente","additionalFields":{"appendAttribution":false,"parse_mode":"HTML"}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[2192,1920],"id":"a424f6ab-48f2-426f-bf66-c6ba6250a413","name":"✅​","webhookId":"f7ce1dda-8ece-49ac-8a66-0137eed78ce1","executeOnce":true},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[2016,1920],"id":"c28ee32c-d24a-4479-ae98-4f676f690c07","name":"Merge"},{"parameters":{"operation":"create","base":{"__rl":true,"value":"={{ $node[\"masterVar\"].json['airtableBase'] }}","mode":"id"},"table":{"__rl":true,"value":"={{ $node[\"masterVar\"].json['Redes Sociales'] }}","mode":"id"},"columns":{"mappingMode":"defineBelow","value":{"Tipo":"={{ $('varPostVideo').item.json.Tipo }}","Caption":"={{ $('varPostVideo').item.json.CaptionIN }}","Frase Clave":"={{ $('varPostVideo').item.json['Frase Clave'].join(', ') }}","Red Social":"Instagram","Fecha publicación":"={{ $now.toISO() }}","Color":"={{ $('varPostVideo').item.json.Color }}"},"matchingColumns":[],"schema":[{"id":"Caption","displayName":"Caption","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Frase Clave","displayName":"Frase Clave","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Tipo","displayName":"Tipo","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"options","options":[{"name":"Imagen","value":"Imagen"},{"name":"Carrusel","value":"Carrusel"},{"name":"Video","value":"Video"}],"readOnly":false,"removed":false},{"id":"Red Social","displayName":"Red Social","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"options","options":[{"name":"Facebook","value":"Facebook"},{"name":"Instagram","value":"Instagram"}],"readOnly":false,"removed":false},{"id":"Color","displayName":"Color","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Fecha publicación","displayName":"Fecha publicación","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"dateTime","readOnly":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[1840,1840],"id":"c46056ee-6ab6-4bbc-88d4-0b2cdad4adaa","name":"CreateINPost1"},{"parameters":{"operation":"create","base":{"__rl":true,"value":"={{ $node[\"masterVar\"].json['airtableBase'] }}","mode":"id"},"table":{"__rl":true,"value":"={{ $node[\"masterVar\"].json['Redes Sociales'] }}","mode":"id"},"columns":{"mappingMode":"defineBelow","value":{"Tipo":"={{ $('varPostVideo').item.json.Tipo }}","Caption":"={{ $('varPostVideo').item.json.CaptionFB }}","Frase Clave":"={{ $('varPostVideo').item.json['Frase Clave'][0] }}","Red Social":"Facebook","Color":"={{ $('varPostVideo').item.json.Color }}","Fecha publicación":"={{ $now.toISO() }}"},"matchingColumns":[],"schema":[{"id":"Caption","displayName":"Caption","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Frase Clave","displayName":"Frase Clave","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Tipo","displayName":"Tipo","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"options","options":[{"name":"Imagen","value":"Imagen"},{"name":"Carrusel","value":"Carrusel"},{"name":"Video","value":"Video"}],"readOnly":false,"removed":false},{"id":"Red Social","displayName":"Red Social","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"options","options":[{"name":"Facebook","value":"Facebook"},{"name":"Instagram","value":"Instagram"}],"readOnly":false,"removed":false},{"id":"Color","displayName":"Color","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Fecha publicación","displayName":"Fecha publicación","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"dateTime","readOnly":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[1840,1984],"id":"7243f49f-6640-429c-9ff8-9b0dc96f4b79","name":"CreateFBPost1"},{"parameters":{"resource":"video","template_id":{"__rl":true,"value":"={{ $json.Plantilla }}","mode":"id","__regex":"^(.*)$"},"audioSettings":{},"layers":{"layerItems":[{"layerId":"quote|text","property":"text","textValue":"={{ $json['Frase Clave'][0] }}"},{"layerId":"Fondo|rectangle","property":"background_color","background_colorValue":"={{ $json.Color }}"}]},"additionalFields":{}},"type":"n8n-nodes-placid.placid","typeVersion":1,"position":[736,2048],"id":"ae5c6d11-2096-4d06-8790-4ba59c8758bd","name":"Create a video from a template","retryOnFail":true,"waitBetweenTries":5000,"onError":"continueErrorOutput"},{"parameters":{"operation":"search","base":{"__rl":true,"value":"={{ $json.airtableBase }}","mode":"id"},"table":{"__rl":true,"value":"={{ $json['Redes Sociales'] }}","mode":"id"},"options":{}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[-400,176],"id":"e7de5c31-c840-4961-9216-2b53d8496571","name":"Search records"},{"parameters":{"assignments":{"assignments":[{"id":"65e4fb7b-f885-41b8-9232-8435caa54ea9","name":"Cliente","value":"Ameyal Inmobiliaria","type":"string"},{"id":"0bcc34a6-73fa-4691-bd4e-0a1f8fc4a02a","name":"airtableBase","value":"appb83b3VCKAonLjs","type":"string"},{"id":"68457664-8845-487a-8c77-ac212972b1a6","name":"Redes Sociales","value":"tblSHOlC917rApYNT","type":"string"},{"id":"d57d84c8-d526-45fe-8a92-d74598655559","name":"plantillaIMG","value":"qpm2c3pvtkrjz","type":"string"},{"id":"bc5799d2-dd3f-4caf-b76f-8b5b2ebdb1d7","name":"plantillaCarrucelTitulo","value":"xvjhrg4x4fihy","type":"string"},{"id":"384ae256-b521-4aac-addb-8ce4995bc95b","name":"plantillaCarruselCuerpo","value":"fz0iidmaxyycr","type":"string"},{"id":"dfa0db3b-54c4-4d64-9674-fb3064cd336a","name":"plantillaCarruselVideo","value":"ignas3vh5cxnp","type":"string"},{"id":"e3e9f354-3f3c-4cdb-8dde-1437dccae795","name":"Color1","value":"#3C53CC","type":"string"},{"id":"84d996d2-f399-4e98-8f66-747b00062691","name":"Color2","value":"#C850C0","type":"string"},{"id":"08bfdf7c-3ffd-451c-82ab-411dd8f9b303","name":"instagram","value":"14397","type":"string"},{"id":"aee51936-f5d7-4482-b16f-a2b6ee853b10","name":"facebook","value":"8833","type":"string"},{"id":"41274361-90f6-4b99-8552-492aee207794","name":"facebook_page","value":"718303238043901","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-560,176],"id":"8cadd75e-8ec9-4caf-afa2-2a8e9fa1a7a6","name":"masterVar1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"026ae6b8-07c2-4ba6-b482-7f2963209d32","leftValue":"={{ $items().length }}","rightValue":30,"operator":{"type":"number","operation":"gt"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-192,176],"id":"280e4891-4595-43a8-8af3-f8401de249a7","name":"If"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[704,192],"id":"78a904ce-5365-44d4-a609-b53d0e2fcd9c","name":"No Operation, do nothing1"},{"parameters":{"operation":"deleteRecord","base":{"__rl":true,"value":"={{ $node[\"masterVar1\"].json['airtableBase'] }}","mode":"id"},"table":{"__rl":true,"value":"={{ $node[\"masterVar1\"].json['Redes Sociales'] }}","mode":"id"},"id":"={{ $json.id }}"},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[496,16],"id":"48cf7819-83ac-4418-8f10-15d96a0eb381","name":"Delete a record"},{"parameters":{"jsCode":"// Máximo permitido\nconst LIMIT = 30;\n\n// Ordenar todos los items por fecha (más antiguos primero)\nconst sorted = items.sort((a, b) => {\n  return new Date(a.json.createdTime) - new Date(b.json.createdTime);\n});\n\n// Calcular cuántos sobran\nconst extraCount = items.length > LIMIT ? items.length - LIMIT : 0;\n\n// Seleccionar los más antiguos (los que sobran)\nconst extras = sorted.slice(0, extraCount);\n\n// Devolver solo los IDs\nreturn extras.map(e => {\n  return {\n    json: {\n      id: e.json.id,\n      createdTime: e.json.createdTime\n    }\n  };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[0,0],"id":"0474cba1-34ae-469f-848d-da6cbf1fe7a5","name":"Code in JavaScript2"},{"parameters":{"batchSize":2,"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[224,0],"id":"42001284-3e7f-4952-a978-959ed1c119f2","name":"Loop Over Items"},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-1296,928],"id":"79562c10-7816-46f6-8e18-50cd97dcf333","name":"When clicking ‘Execute workflow’"},{"parameters":{"operation":"search","base":{"__rl":true,"value":"={{ $json.airtableBase }}","mode":"id"},"table":{"__rl":true,"value":"={{ $json['Redes Sociales'] }}","mode":"id"},"options":{}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[-832,928],"id":"0dbb34d1-d4da-418f-a719-b34ccf2ef2e0","name":"Search records1"},{"parameters":{"jsCode":"// Leer los colores desde masterVar sin conectarlo directamente\nconst color1 = $node[\"masterVar\"].json[\"Color1\"];\nconst color2 = $node[\"masterVar\"].json[\"Color2\"];\nconst color3 = $node[\"masterVar\"].json[\"Color3\"];\n\nif (!color1 || !color2 || !color3) {\n  throw new Error(\"Las variables Color1, Color2 y Color3 deben existir en el nodo masterVar\");\n}\n\n// Los items que entran provienen de Search Records1 (posts históricos)\nconst sorted = items.sort((a, b) => new Date(b.json.createdTime) - new Date(a.json.createdTime));\n\n// Últimos 10 tipos\nconst history = sorted.slice(0, 10).map(e => e.json.Tipo);\n\n// Conteo de cada tipo\nconst counts = {\n  Video: history.filter(t => t === \"Video\").length,\n  Imagen: history.filter(t => t === \"Imagen\").length,\n  Carrusel: history.filter(t => t === \"Carrusel\").length,\n};\n\n// Pesos base\nlet weights = { Video: 0.4, Imagen: 0.3, Carrusel: 0.3 };\n\n// Ajuste dinámico si un tipo domina demasiado\nconst limit = 4;\nfor (let tipo of [\"Video\", \"Imagen\", \"Carrusel\"]) {\n  if (counts[tipo] >= limit) {\n    weights[tipo] = 0.1;\n    const others = Object.keys(weights).filter(t => t !== tipo);\n    const extra = (1 - (weights.Video + weights.Imagen + weights.Carrusel)) / others.length;\n    for (let o of others) weights[o] += extra;\n  }\n}\n\nfunction weightedChoice(weights) {\n  const r = Math.random();\n  if (r < weights.Video) return \"Video\";\n  if (r < weights.Video + weights.Imagen) return \"Imagen\";\n  return \"Carrusel\";\n}\n\nlet nextType = weightedChoice(weights);\n\n// Evitar más de 3 iguales seguidos\nconst last3 = history.slice(0, 3);\nif (last3.length === 3 && last3.every(t => t === nextType)) {\n  const alternatives = [\"Video\", \"Imagen\", \"Carrusel\"].filter(t => t !== nextType);\n  nextType = alternatives[Math.floor(Math.random() * alternatives.length)];\n}\n\n// Alternancia entre 3 colores\nconst lastColor = sorted[0]?.json.Color || null;\nconst allColors = [color1, color2, color3];\nlet colorOptions = allColors;\n\nif (lastColor) {\n  colorOptions = allColors.filter(c => c !== lastColor);\n}\n\nconst nextColor = colorOptions[Math.floor(Math.random() * colorOptions.length)];\n\n// Devolver solo un resultado global\nreturn [\n  {\n    json: {\n      Tipo: nextType,\n      Color: nextColor\n    }\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-608,928],"id":"90f9e45d-a05f-49a5-b4e3-775da1982a82","name":"variablesDinamicas","executeOnce":true},{"parameters":{"content":"## ACTUALIZAR\nVar","height":272,"width":224},"type":"n8n-nodes-base.stickyNote","position":[-1104,848],"typeVersion":1,"id":"978dab04-0f36-4adb-949c-5da3d52452ed","name":"Sticky Note3"},{"parameters":{"resource":"media","mediaUrl":"={{ $json.image_url }}"},"type":"@blotato/n8n-nodes-blotato.blotato","typeVersion":2,"position":[1536,464],"id":"76ad3c82-5520-4354-b497-880721bea29c","name":"Upload media","retryOnFail":true,"onError":"continueErrorOutput"},{"parameters":{"resource":"media","mediaUrl":"={{ $json.img }}"},"type":"@blotato/n8n-nodes-blotato.blotato","typeVersion":2,"position":[2112,1280],"id":"ab558ac1-96c2-496e-991e-b6d25a6ac891","name":"Upload media1","retryOnFail":true,"onError":"continueErrorOutput"},{"parameters":{"platform":"facebook","accountId":{"__rl":true,"value":"={{ $node[\"masterVar\"].json['facebook'] }}","mode":"id"},"postContentText":"={{ $json['Caption de Facebook'] }}","postContentMediaUrls":"={{ $json.mediaUrlsCarrusel }}","facebookPageId":{"__rl":true,"value":"={{ $node[\"masterVar\"].json['facebook_page'] }}","mode":"id"},"options":{}},"type":"@blotato/n8n-nodes-blotato.blotato","typeVersion":2,"position":[2752,944],"id":"c3734166-65b6-4401-a63b-63e737a0d69c","name":"FacebookCarrusel","retryOnFail":true,"onError":"continueErrorOutput"},{"parameters":{"resource":"media","mediaUrl":"={{ $json.video_url }}"},"type":"@blotato/n8n-nodes-blotato.blotato","typeVersion":2,"position":[1120,2032],"id":"44183774-c988-4692-a6a3-28cd0481c1aa","name":"Upload media2","retryOnFail":true,"onError":"continueErrorOutput"},{"parameters":{"platform":"facebook","accountId":{"__rl":true,"value":"={{ $node[\"masterVar\"].json['facebook'] }}","mode":"id"},"postContentText":"={{ $('varPostVideo').item.json.CaptionFB }}","postContentMediaUrls":"={{ $json.url }}","facebookPageId":{"__rl":true,"value":"={{ $node[\"masterVar\"].json['facebook_page'] }}","mode":"id"},"options":{"facebookMediaType":"reel"}},"type":"@blotato/n8n-nodes-blotato.blotato","typeVersion":2,"position":[1408,1856],"id":"acb3a04b-0c27-48c0-bf99-40b39bbe99c0","name":"FacebookReal","retryOnFail":true,"onError":"continueErrorOutput"},{"parameters":{"accountId":{"__rl":true,"value":"={{ $node[\"masterVar\"].json['instagram'] }}","mode":"id"},"postContentText":"={{ $(\"varPostVideo\").item.json.CaptionIN }}","postContentMediaUrls":"={{ $json.url }}","options":{"instagramMediaType":"reel"}},"type":"@blotato/n8n-nodes-blotato.blotato","typeVersion":2,"position":[1408,2000],"id":"18941252-d443-4a3f-992c-fbb438c154bf","name":"InstagramReal","retryOnFail":true,"onError":"continueErrorOutput"},{"parameters":{"accountId":{"__rl":true,"value":"={{ $node[\"masterVar\"].json['instagram'] }}","mode":"id"},"postContentText":"={{ $(\"varPostVideo\").item.json.CaptionIN }}","postContentMediaUrls":"={{ $json.url }}","options":{"instagramMediaType":"story"}},"type":"@blotato/n8n-nodes-blotato.blotato","typeVersion":2,"position":[1408,2160],"id":"47334e51-c80b-4462-9d5d-66c06c83cfc4","name":"InstagramStory","retryOnFail":true,"onError":"continueErrorOutput"},{"parameters":{"accountId":{"__rl":true,"value":"={{ $node[\"masterVar\"].json['instagram'] }}","mode":"id"},"postContentText":"={{ $json['Caption de Instagram'] }}","postContentMediaUrls":"={{ $json.mediaUrlsCarrusel }}","options":{}},"type":"@blotato/n8n-nodes-blotato.blotato","typeVersion":2,"position":[2752,1120],"id":"9b02f704-84d5-48ad-a469-61d77f225145","name":"InstagramCarrusel","retryOnFail":true,"onError":"continueErrorOutput"},{"parameters":{"platform":"facebook","accountId":{"__rl":true,"value":"={{ $node[\"masterVar\"].json['facebook'] }}","mode":"id"},"postContentText":"={{ $(\"varPostIMG\").item.json.CaptionFB }}","postContentMediaUrls":"={{ $json.url }}","facebookPageId":{"__rl":true,"value":"={{ $node[\"masterVar\"].json['facebook_page'] }}","mode":"id"},"options":{}},"type":"@blotato/n8n-nodes-blotato.blotato","typeVersion":2,"position":[1824,272],"id":"65fb158f-4868-4b8c-902c-5445fe015fdb","name":"FacebookPost","retryOnFail":true,"onError":"continueErrorOutput"},{"parameters":{"accountId":{"__rl":true,"value":"={{ $node[\"masterVar\"].json['instagram'] }}","mode":"id"},"postContentText":"={{ $(\"varPostIMG\").item.json.CaptionIN }}","postContentMediaUrls":"={{ $json.url }}","options":{}},"type":"@blotato/n8n-nodes-blotato.blotato","typeVersion":2,"position":[1824,432],"id":"ff386806-137a-4f67-8de4-bfa693d435d1","name":"InstagramPost","retryOnFail":true,"onError":"continueErrorOutput"}],"connections":{"Schedule Trigger1":{"main":[[{"node":"Code1","type":"main","index":0},{"node":"masterVar1","type":"main","index":0}]]},"Create an image from a template":{"main":[[{"node":"Wait12","type":"main","index":0}],[{"node":"⚠️​2","type":"main","index":0}]]},"Wait11":{"main":[[{"node":"CreateINPost","type":"main","index":0}]]},"⚠️​2":{"main":[[{"node":"No Operation, do nothing2","type":"main","index":0}]]},"Wait12":{"main":[[{"node":"Upload media","type":"main","index":0}]]},"Wait13":{"main":[[{"node":"CreateFBPost","type":"main","index":0}]]},"Wait15":{"main":[[{"node":"Merge4","type":"main","index":0}]]},"Loop Over Items2":{"main":[[{"node":"Code","type":"main","index":0}],[{"node":"slides","type":"main","index":0}]]},"Wait16":{"main":[[{"node":"varSlides1","type":"main","index":0}]]},"Code":{"main":[[{"node":"Merge4","type":"main","index":1}]]},"varSlides1":{"main":[[{"node":"Loop Over Items2","type":"main","index":0}]]},"Merge4":{"main":[[{"node":"imgSlide1","type":"main","index":0}]]},"imgSlide1":{"main":[[{"node":"Loop Over Items3","type":"main","index":0}]]},"Loop Over Items3":{"main":[[{"node":"mediaUrlsCarrusel1","type":"main","index":0}],[{"node":"Upload media1","type":"main","index":0}]]},"Wait17":{"main":[[{"node":"Loop Over Items3","type":"main","index":0}]]},"Merge5":{"main":[[{"node":"varPostCarrusel0","type":"main","index":0}]]},"Wait18":{"main":[[{"node":"Create a record6","type":"main","index":0}]]},"⚠️​3":{"main":[[{"node":"No Operation, do nothing3","type":"main","index":0}]]},"✅​3":{"main":[[{"node":"No Operation, do nothing3","type":"main","index":0}]]},"Create a record6":{"main":[[{"node":"Merge6","type":"main","index":0}]]},"Wait19":{"main":[[{"node":"Create a record7","type":"main","index":0}]]},"Create a record7":{"main":[[{"node":"Merge6","type":"main","index":1}]]},"mediaUrlsCarrusel1":{"main":[[{"node":"Merge5","type":"main","index":1}]]},"Merge6":{"main":[[{"node":"✅​3","type":"main","index":0}]]},"✅​1":{"main":[[{"node":"No Operation, do nothing2","type":"main","index":0}]]},"Merge7":{"main":[[{"node":"✅​1","type":"main","index":0}]]},"Wait":{"main":[[{"node":"masterVar","type":"main","index":0}]]},"Code1":{"main":[[{"node":"Wait","type":"main","index":0}]]},"masterVar":{"main":[[{"node":"Search records1","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Code in JavaScript","type":"main","index":0}]]},"Code in JavaScript":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Switch":{"main":[[{"node":"varPostIMG","type":"main","index":0}],[{"node":"varPostCarrusel3","type":"main","index":0},{"node":"varPostCarruselCuerpo","type":"main","index":0},{"node":"varPostCarrusel2","type":"main","index":0}],[{"node":"varPostVideo","type":"main","index":0}]]},"varPostIMG":{"main":[[{"node":"fondoIMG","type":"main","index":0}]]},"fondoIMG":{"main":[[{"node":"Wait1","type":"main","index":0}]]},"Wait1":{"main":[[{"node":"Create an image from a template","type":"main","index":0}]]},"CreateINPost":{"main":[[{"node":"Merge7","type":"main","index":0}]]},"CreateFBPost":{"main":[[{"node":"Merge7","type":"main","index":1}]]},"fondoIMG1":{"main":[[{"node":"Wait2","type":"main","index":0}]]},"Wait2":{"main":[[{"node":"PortadaCarrusel","type":"main","index":0}]]},"PortadaCarrusel":{"main":[[{"node":"Wait15","type":"main","index":0}],[{"node":"⚠️​3","type":"main","index":0}]]},"Code in JavaScript1":{"main":[[{"node":"Loop Over Items2","type":"main","index":0}]]},"varPostCarruselCuerpo":{"main":[[{"node":"Code in JavaScript1","type":"main","index":0}]]},"slides":{"main":[[{"node":"Wait16","type":"main","index":0}],[{"node":"⚠️​3","type":"main","index":0}]]},"varPostCarrusel2":{"main":[[{"node":"Merge5","type":"main","index":0}]]},"varPostCarrusel3":{"main":[[{"node":"fondoIMG1","type":"main","index":0}]]},"varPostCarrusel0":{"main":[[{"node":"FacebookCarrusel","type":"main","index":0},{"node":"InstagramCarrusel","type":"main","index":0}]]},"Post Historicos":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"varPostVideo":{"main":[[{"node":"Create a video from a template","type":"main","index":0}]]},"Wait14":{"main":[[{"node":"CreateINPost1","type":"main","index":0}]]},"⚠️​":{"main":[[{"node":"No Operation, do nothing","type":"main","index":0}]]},"Wait20":{"main":[[{"node":"Upload media2","type":"main","index":0}]]},"Wait21":{"main":[[{"node":"CreateFBPost1","type":"main","index":0}]]},"✅​":{"main":[[{"node":"No Operation, do nothing","type":"main","index":0}]]},"Merge":{"main":[[{"node":"✅​","type":"main","index":0}]]},"CreateINPost1":{"main":[[{"node":"Merge","type":"main","index":0}]]},"CreateFBPost1":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Create a video from a template":{"main":[[{"node":"Wait20","type":"main","index":0}],[{"node":"⚠️​","type":"main","index":0}]]},"masterVar1":{"main":[[{"node":"Search records","type":"main","index":0}]]},"Search records":{"main":[[{"node":"If","type":"main","index":0}]]},"If":{"main":[[{"node":"Code in JavaScript2","type":"main","index":0}],[{"node":"No Operation, do nothing1","type":"main","index":0}]]},"Code in JavaScript2":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Loop Over Items":{"main":[[{"node":"No Operation, do nothing1","type":"main","index":0}],[{"node":"Delete a record","type":"main","index":0}]]},"Delete a record":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"When clicking ‘Execute workflow’":{"main":[[{"node":"masterVar","type":"main","index":0}]]},"Search records1":{"main":[[{"node":"variablesDinamicas","type":"main","index":0}]]},"variablesDinamicas":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Upload media":{"main":[[{"node":"FacebookPost","type":"main","index":0},{"node":"InstagramPost","type":"main","index":0}],[{"node":"⚠️​2","type":"main","index":0}]]},"Upload media1":{"main":[[{"node":"Wait17","type":"main","index":0}],[{"node":"⚠️​3","type":"main","index":0}]]},"FacebookCarrusel":{"main":[[{"node":"Wait18","type":"main","index":0}],[{"node":"⚠️​3","type":"main","index":0}]]},"Upload media2":{"main":[[{"node":"FacebookReal","type":"main","index":0},{"node":"InstagramReal","type":"main","index":0},{"node":"InstagramStory","type":"main","index":0}]]},"FacebookReal":{"main":[[{"node":"Wait14","type":"main","index":0}],[{"node":"⚠️​","type":"main","index":0}]]},"InstagramReal":{"main":[[{"node":"Wait21","type":"main","index":0}],[{"node":"⚠️​","type":"main","index":0}]]},"InstagramStory":{"main":[[{"node":"Wait21","type":"main","index":0}],[{"node":"⚠️​","type":"main","index":0}]]},"InstagramCarrusel":{"main":[[{"node":"Wait19","type":"main","index":0}],[{"node":"⚠️​3","type":"main","index":0}]]},"FacebookPost":{"main":[[{"node":"Wait11","type":"main","index":0}],[{"node":"⚠️​2","type":"main","index":0}]]},"InstagramPost":{"main":[[{"node":"Wait13","type":"main","index":0}],[{"node":"⚠️​2","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"0c159f57-af97-4758-a742-515199d57f72","activeVersionId":null,"versionCounter":2,"triggerCount":0,"shared":[{"updatedAt":"2026-01-06T00:16:32.714Z","createdAt":"2026-01-06T00:16:32.714Z","role":"workflow:owner","workflowId":"fduu1PJZL5bqRtfs","projectId":"ZrZEhploCo3SzGcR","project":{"updatedAt":"2026-01-05T04:06:43.891Z","createdAt":"2026-01-05T04:04:25.716Z","id":"ZrZEhploCo3SzGcR","name":"Admin KiroxOn <admin@kiroxon.com>","type":"personal","icon":null,"description":null,"projectRelations":[{"updatedAt":"2026-01-05T04:04:25.716Z","createdAt":"2026-01-05T04:04:25.716Z","userId":"81f20b86-05fa-4c10-a4c5-1d9ee6757629","projectId":"ZrZEhploCo3SzGcR","user":{"updatedAt":"2026-02-09T11:30:00.000Z","createdAt":"2026-01-05T04:04:24.404Z","id":"81f20b86-05fa-4c10-a4c5-1d9ee6757629","email":"admin@kiroxon.com","firstName":"Admin","lastName":"KiroxOn","personalizationAnswers":{"version":"v4","personalization_survey_submitted_at":"2026-01-05T04:07:15.797Z","personalization_survey_n8n_version":"1.103.2","companySize":"<20","companyType":"saas","role":"customer-support","reportedSource":"google"},"settings":{"userActivated":true,"easyAIWorkflowOnboarded":true,"firstSuccessfulWorkflowId":"YL3tGlIxXevhhOL3","userActivatedAt":1767649210078,"npsSurvey":{"responded":true,"lastShownAt":1767990714821}},"disabled":false,"mfaEnabled":false,"lastActiveAt":"2026-02-09","isPending":false}}]}}],"tags":[{"updatedAt":"2026-01-05T21:52:36.013Z","createdAt":"2026-01-05T21:52:36.013Z","id":"NMcHP8etRpwSn7yA","name":"Blotato"},{"updatedAt":"2026-01-05T04:42:50.080Z","createdAt":"2026-01-05T04:42:50.080Z","id":"WoZWCKdRNB9sNHTT","name":"Redes Sociales"},{"updatedAt":"2026-01-05T21:52:36.017Z","createdAt":"2026-01-05T21:52:36.017Z","id":"m6Xql0arnFi8YTKV","name":"Placid"}],"activeVersion":null}